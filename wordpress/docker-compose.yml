version: '3'
services:
    # MySQL
    mysql:
        image: mysql:5.7
        command:
            - "--character-set-server=utf8"
            - "--collation-server=utf8_unicode_ci"
        ports:
            - "${LOCAL_DB_PORT}:3306"
        restart: on-failure:5
        container_name: "${MYSQL_CONTAINER_NAME}"
        volumes:
            - ./mysql:/var/lib/mysql
        environment:
            MYSQL_USER: "${MYSQL_USER}"
            MYSQL_DATABASE: "${MYSQL_DATABASE}"
            MYSQL_PASSWORD: "${MYSQL_PASSWORD}"
            MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"

    # WordPress
    wordpress:
        depends_on:
            - mysql
        image: wordpress:latest
        container_name: "${WORDPRESS_CONTAINER_NAME}"
        ports:
            - "${LOCAL_SERVER_HTTP_PORT}:80"
            - "${LOCAL_SERVER_HTTPS_PORT}:443"
        restart: on-failure:5
        volumes:
            - ./wordpress:/var/www/html
            - ./wordpress-php/conf.d/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini
        environment:
            WORDPRESS_DB_HOST: mysql
            WORDPRESS_DB_USER: "${WORDPRESS_DB_USER}"
            WORDPRESS_DB_PASSWORD: "${WORDPRESS_DB_PASSWORD}"
            WORDPRESS_DB_NAME: "${WORDPRESS_DB_NAME}"